"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[986],{12039:(e,t,s)=>{s.d(t,{I:()=>m,SQ:()=>p,_2:()=>g,hO:()=>h,lp:()=>f,mB:()=>x,rI:()=>d,ty:()=>u});var a=s(90702),n=s(16606),r=s(47910),l=s(23924),i=s(708),o=s(78428),c=s(79321);let d=r.bL,u=r.l9,m=r.YJ;r.ZL,r.Pb,r.z6,n.forwardRef((e,t)=>{let{className:s,inset:n,children:i,...o}=e;return(0,a.jsxs)(r.ZP,{ref:t,className:(0,c.cn)("flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",s),...o,children:[i,(0,a.jsx)(l.A,{className:"ml-auto"})]})}).displayName=r.ZP.displayName,n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.G5,{ref:t,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...n})}).displayName=r.G5.displayName;let p=n.forwardRef((e,t)=>{let{className:s,sideOffset:n=4,...l}=e;return(0,a.jsx)(r.ZL,{children:(0,a.jsx)(r.UC,{ref:t,sideOffset:n,className:(0,c.cn)("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-white p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",s),...l})})});p.displayName=r.UC.displayName;let g=n.forwardRef((e,t)=>{let{className:s,inset:n,...l}=e;return(0,a.jsx)(r.q7,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",n&&"pl-8",s),...l})});g.displayName=r.q7.displayName;let h=n.forwardRef((e,t)=>{let{className:s,children:n,checked:l,...o}=e;return(0,a.jsxs)(r.H_,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),checked:l,...o,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(i.A,{className:"h-4 w-4"})})}),n]})});h.displayName=r.H_.displayName,n.forwardRef((e,t)=>{let{className:s,children:n,...l}=e;return(0,a.jsxs)(r.hN,{ref:t,className:(0,c.cn)("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(r.VF,{children:(0,a.jsx)(o.A,{className:"h-2 w-2 fill-current"})})}),n]})}).displayName=r.hN.displayName;let f=n.forwardRef((e,t)=>{let{className:s,inset:n,...l}=e;return(0,a.jsx)(r.JU,{ref:t,className:(0,c.cn)("px-2 py-1.5 text-sm font-semibold",n&&"pl-8",s),...l})});f.displayName=r.JU.displayName;let x=n.forwardRef((e,t)=>{let{className:s,...n}=e;return(0,a.jsx)(r.wv,{ref:t,className:(0,c.cn)("-mx-1 my-1 h-px bg-muted",s),...n})});x.displayName=r.wv.displayName},14986:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var a=s(90702),n=s(16606),r=s(43466),l=s(57530),i=s(52961),o=s(23924),c=s(75491),d=s(49333),u=s(96922),m=s(71224),p=s(85507);let g=(0,p.A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var h=s(50738);let f=(0,p.A)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var x=s(29809),y=s(73554);let v=(0,p.A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var j=s(708),N=s(12039);function w(e){let{onModelChange:t}=e,[s,l]=(0,n.useState)([]),[i,o]=(0,n.useState)(null),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),{toast:p}=(0,y.dj)();(0,n.useEffect)(()=>{g()},[]);let g=async()=>{try{d(!0);let[e,t]=await Promise.all([x.F.models.listModels(),x.F.models.getCurrentModel()]);l(e),o(t)}catch(e){console.error("Failed to fetch models:",e),p({variant:"destructive",title:"Error",description:"Failed to load available models."})}finally{d(!1)}},f=async e=>{if(e.id!==(null==i?void 0:i.id))try{m(!0);let s=await x.F.models.setCurrentModel(e.id);o(s),t&&t(s),p({title:"Model Changed",description:"Now using ".concat(s.name)})}catch(e){console.error("Failed to change model:",e),p({variant:"destructive",title:"Error",description:"Failed to change the model. Please try again."})}finally{m(!1)}},w=s.reduce((e,t)=>(e[t.provider]||(e[t.provider]=[]),e[t.provider].push(t),e),{});return(0,a.jsxs)(N.rI,{children:[(0,a.jsx)(N.ty,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"outline",size:"sm",className:"h-8 gap-1 border-purple-200 bg-purple-50 hover:bg-purple-100 text-purple-700",disabled:c||u,children:[(0,a.jsx)(v,{className:"h-3.5 w-3.5"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:c?"Loading...":(null==i?void 0:i.name)||"Select Model"}),(0,a.jsx)(h.A,{className:"h-3.5 w-3.5 opacity-70"})]})}),(0,a.jsxs)(N.SQ,{align:"end",className:"w-[240px] bg-white shadow-lg border border-gray-200",children:[(0,a.jsx)(N.lp,{children:"Select AI Model"}),Object.entries(w).map(e=>{let[t,s]=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)(N.mB,{}),(0,a.jsx)(N.lp,{className:"text-xs text-muted-foreground",children:t}),(0,a.jsx)(N.I,{children:s.map(e=>(0,a.jsxs)(N._2,{onClick:()=>f(e),disabled:u,className:"flex items-center justify-between cursor-pointer",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("span",{children:e.name}),e.description&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:e.description})]}),(null==i?void 0:i.id)===e.id&&(0,a.jsx)(j.A,{className:"h-4 w-4 text-green-600"})]},e.id))})]},t)})]})]})}var b=s(5504),_=s(49570);let A=_.bL,S=_.R6,C=_.Ke;var k=s(93843),I=s(88443);let E=e=>{if("model"!==e.role||!e.content)return null;try{let t=JSON.parse(e.content);if(t&&"object"==typeof t&&t.type&&t.status)return console.log("[AIChatPanel] Parsed chat content as potential InvestigationEvent:",t.type),t}catch(e){}return null};function R(e){let{isOpen:t,onToggle:s,notebookId:p}=e,[v,j]=(0,n.useState)([]),[N,_]=(0,n.useState)(""),[R,P]=(0,n.useState)([]),[O,D]=(0,n.useState)(null),[M,z]=(0,n.useState)(!1),[F,L]=(0,n.useState)(null),[T,J]=(0,n.useState)(null),[U,q]=(0,n.useState)(null),[Z,H]=(0,n.useState)(!1),[$,G]=(0,n.useState)({}),{toast:B}=(0,y.dj)(),K=(0,n.useRef)(null),V=(0,n.useRef)(null),Q=(0,I.F)(e=>e.handleCellUpdate);(0,I.F)(e=>e.updateCell);let W=(0,I.F)(e=>e.registerSendChatMessageFunction),{isInvestigationRunning:X,currentStatus:Y,wsStatus:ee}=(0,k.R)({notebookId:p,onCreateCell:e=>{console.log("[AIChatPanel onCreateCell using Zustand] Creating cell:",e.id,e.type),Q({id:e.id,notebook_id:p,type:e.type,content:e.content,status:e.status,result:e.result,error:e.error,metadata:e.metadata,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),position:Date.now()})},onUpdateCell:(e,t)=>{console.log("[AIChatPanel onUpdateCell using Zustand] Updating cell:",e,t),Q({id:e,...t,updated_at:new Date().toISOString()})},onError:e=>{console.error("[AIChatPanel Investigation Error]:",e),J("Investigation Error: ".concat(e)),B({variant:"destructive",title:"Investigation Error",description:e})}});(0,n.useEffect)(()=>{t&&!O&&et()},[t]),(0,n.useEffect)(()=>{t&&V.current&&V.current.focus()},[t]),(0,n.useEffect)(()=>{K.current&&K.current.scrollIntoView({behavior:"smooth"})},[v,$]),(0,n.useEffect)(()=>{if(v.length>0){console.log("Chat messages updated, current count:",v.length);let e=v[v.length-1];e&&(console.log("Last message role:",e.role),console.log("Last message content type:",typeof e.content),console.log("Last message content preview:","string"==typeof e.content?e.content.substring(0,100):"Not a string"))}},[v]);let et=async()=>{try{z(!0),J(null);let e=await x.F.chat.createSession(p);if(D(e.session_id),e.session_id){let t=await x.F.chat.getSessionMessages(e.session_id);if(t.length>0){er(t);let e=[],s=[];t.forEach(t=>{let a=E(t);a?["plan_created","plan_cell_created","step_completed","summary_started","summary_update","summary_cell_created","summary_cell_error","github_tool_cell_created","github_tool_error","investigation_complete","error"].includes(a.type)&&s.push(a):e.push(t)}),j(e),P(s)}}}catch(e){console.error("Failed to create chat session:",e),J("Failed to initialize chat. Please try again."),B({variant:"destructive",title:"Chat Error",description:"Failed to initialize chat session. Please try again."})}finally{z(!1)}},es=e=>{let t="An unexpected error occurred. Please try again.";try{if(!e)return t;if("string"==typeof e){if(e.startsWith("{")||e.includes('{"error":'))try{let s=JSON.parse(e);s.error&&(t="string"==typeof s.error?s.error:s.error.message||"Unknown error")}catch(a){let s=e.match(/error[":]\s*"?([^"]+)"?/i);t=s&&s[1]?s[1]:e}else t=e}else if(e instanceof Error)t=e.message;else if(e.message){if(e.message.startsWith("{")||e.message.includes('{"error":'))try{let s=JSON.parse(e.message);s.error&&(t="string"==typeof s.error?s.error:s.error.message||"Unknown error")}catch(s){t=e.message}else t=e.message}else e.response&&e.response.data&&("string"==typeof e.response.data?t=e.response.data:e.response.data.error&&(t="string"==typeof e.response.data.error?e.response.data.error:e.response.data.error.message||"API error"))}catch(e){console.error("Error parsing error message:",e)}if(t.includes("Connection error")||t.includes("network")||t.includes("ECONNREFUSED"))return"Connection to the AI service failed. Please check your internet connection and try again later.";if(t.includes("timeout")||t.includes("timed out"))return"The request timed out. The server might be busy or experiencing issues. Please try again later.";if(t.includes("status_code: 500")||t.includes("Internal Server Error"))return"The server encountered an error. Please try again later.";if(t.includes("overloaded")||t.includes("capacity"))return"The AI service is currently overloaded. Please try again in a moment.";if(t.includes("rate limit")||t.includes("too many requests"))return"Rate limit exceeded. Please wait a moment before trying again.";else if(t.includes("stream")&&t.includes("error"))return"Error in streaming response. Please try again.";return t},ea=async()=>{if(U&&!M&&O){H(!0),J(null),z(!0);try{await x.F.chat.unifiedChat(U,p,O,el),q(null)}catch(t){console.error("Error retrying message:",t);let e=es(t);J(e),B({variant:"destructive",title:"Chat Error",description:e})}finally{z(!1),H(!1)}}},en=e=>{try{let t=JSON.parse(e);if(t&&"object"==typeof t&&"status_response"===t.type)return t}catch(e){}return null},er=e=>{let t={...$},s=!1;e.forEach(e=>{if("model"===e.role){var a;let n=en(e.content);if(n){let e=n.agent_type;t[e]||(t[e]={agentType:e,messages:[],isActive:!0,isExpanded:!1}),t[e].messages.push(n),t[e].isActive=!0,s=!0}else e.agent&&(null===(a=t[e.agent])||void 0===a?void 0:a.isActive)&&(t[e.agent].isActive=!1,s=!0)}}),s&&G(t)},el=e=>{if(console.log("Received message or event:",e),"type"in e&&"cell_created"===e.type);else if("role"in e){let s=en(e.content);if(s&&"model"===e.role&&(er([e]),"chat_agent"!==s.agent_type))return;try{let s=JSON.parse(e.content);if(s&&"object"==typeof s&&"cell_response"===s.type){if(console.log("[AIChatPanel] Processing cell_response:",s),s.cell_params&&s.cell_id){var t;let e={id:s.cell_id,notebook_id:s.cell_params.notebook_id||p,type:s.cell_params.cell_type||"markdown",content:s.cell_params.content||"",status:s.cell_params.status||"idle",result:s.cell_params.result,error:s.cell_params.error,metadata:s.cell_params.metadata,created_at:s.cell_params.created_at||new Date().toISOString(),updated_at:s.cell_params.updated_at||new Date().toISOString(),position:null!==(t=s.cell_params.position)&&void 0!==t?t:Date.now(),dependencies:s.cell_params.dependencies||[],connection_id:s.cell_params.connection_id,tool_call_id:s.cell_params.tool_call_id,tool_name:s.cell_params.tool_name,tool_arguments:s.cell_params.tool_arguments,settings:s.cell_params.settings,step_id:s.cell_params.step_id};console.log("Calling handleCellUpdate with:",e),Q(e)}else console.error("Received cell_response is missing cell_params or top-level cell_id",s);return}}catch(t){console.log("[AIChatPanel handleMessageOrEvent] Processing as regular message:",e.content.substring(0,50))}j(t=>{let s=[...t],a=s[s.length-1];return a&&"user"===a.role&&"user"===e.role&&"string"==typeof a.content&&"string"==typeof e.content?(a.content+="\n"+e.content,a.timestamp=e.timestamp):s.push(e),er([e]),s}),"model"===e.role&&!en(e.content)&&e.agent&&G(t=>{var s;return(null===(s=t[e.agent])||void 0===s?void 0:s.isActive)?{...t,[e.agent]:{...t[e.agent],isActive:!1}}:t})}},ei=async e=>{null==e||e.preventDefault();let t=N.trim();t&&(_(""),await eo(t))},eo=async e=>{if(!e||M||!O){console.warn("[AIChatPanel programmaticSendMessage] Aborted: Invalid state (isLoading, no sessionId, or empty message)",{isLoading:M,sessionId:O,messageContent:e});return}J(null),q(null),z(!0);let t={role:"user",content:e,timestamp:new Date().toISOString(),id:"user-".concat(Date.now())};j(e=>[...e,t]);let s={role:"model",content:"",timestamp:new Date().toISOString(),id:"assistant-loading-".concat(Date.now())};try{j(e=>[...e,s]),console.log("Calling sendMessage with sessionId: ".concat(O)),await x.F.chat.sendMessage(O,e,el),j(e=>e.filter(e=>e.id!==s.id))}catch(n){console.error("Error sending message:",n),j(e=>e.filter(e=>e.id!==s.id)),q(e);let t=es(n);J(t);let a={role:"model",content:"Error: ".concat(t,". Please try again or rephrase your question."),timestamp:new Date().toISOString(),agent:"system"};j(e=>[...e,a]),B({variant:"destructive",title:"Chat Error",description:t})}finally{z(!1)}};(0,n.useEffect)(()=>(console.log("[AIChatPanel Registration Effect] Running. Session ID: ".concat(O,", Investigation Running: ").concat(X)),O&&!X?(console.log("[AIChatPanel] Registering programmaticSendMessage with Zustand store."),W(eo)):(console.log("[AIChatPanel] De-registering programmaticSendMessage (Session ID: ".concat(O,", Investigation Running: ").concat(X,").")),W(null)),()=>{console.log("[AIChatPanel] De-registering programmaticSendMessage on cleanup."),W(null)}),[O,X,W]),(0,n.useEffect)(()=>{console.log("[Investigation Status Effect] isInvestigationRunning: ".concat(X)),X||(console.log("[Investigation Status Effect] Condition met: !isInvestigationRunning. Attempting to deactivate agents."),G(e=>{console.log("[Investigation Status Effect] Inside setAgentStatuses. Previous statuses:",JSON.stringify(e));let t={...e},s=!1;return(Object.keys(t).forEach(e=>{var a;"chat_agent"!==e&&(null===(a=t[e])||void 0===a?void 0:a.isActive)&&(console.log("[Investigation Status Effect] Deactivating agent: ".concat(e)),t[e]={...t[e],isActive:!1},s=!0)}),s)?(console.log("[Investigation Status Effect] Statuses changed. New statuses:",JSON.stringify(t)),t):(console.log("[Investigation Status Effect] No status changes needed."),e)}))},[X,G]);let ec=e=>{try{return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(e){return""}},ed=e=>{G(t=>({...t,[e]:{...t[e],isExpanded:!t[e].isExpanded}}))},eu=v.filter(e=>{if("model"===e.role){let t=en(e.content);if(t&&"chat_agent"!==t.agent_type)return!1}return!0}),em=e=>{try{let t=JSON.parse(e);if(t&&"status_response"===t.type)return t.content||"[Status Update]";if("object"!=typeof t||null===t)return console.warn("Parsed non-object JSON, showing raw content:",e),e;if("string"==typeof t.message)return console.warn("Rendering .message from unknown structure:",t),t.message;if("string"==typeof t.content)return console.warn("Rendering .content from unknown structure:",t),t.content;return console.warn("Parsed unknown object structure, showing JSON:",t),(0,a.jsx)("pre",{className:"text-xs bg-gray-100 dark:bg-gray-800 p-2 rounded overflow-x-auto",children:JSON.stringify(t,null,2)})}catch(t){return e}};return(0,a.jsx)("div",{className:"fixed right-0 top-0 bottom-0 bg-white border-l border-gray-200 shadow-lg transition-all duration-300 ease-in-out z-20 flex flex-col ".concat(t?"w-96":"w-0 opacity-0"),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ei()),"Escape"===e.key&&s()},children:t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"p-4 border-b bg-purple-50 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(i.A,{className:"h-5 w-5 text-purple-600 mr-2"}),(0,a.jsx)("h3",{className:"font-medium",children:"Sherlog AI Assistant"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(w,{onModelChange:e=>{L(e)}}),(0,a.jsx)(r.$,{variant:"ghost",size:"sm",onClick:s,className:"h-8 w-8 p-0 hover:bg-purple-100","aria-label":"Close panel",children:(0,a.jsx)(o.A,{className:"h-5 w-5 text-purple-600"})})]})]}),(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 bg-gray-50",children:[T&&(0,a.jsxs)(b.Fc,{variant:"destructive",className:"mb-4 animate-in fade-in-0 slide-in-from-top-5",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)(c.A,{className:"h-4 w-4 mt-0.5 mr-2"}),(0,a.jsxs)("div",{children:[(0,a.jsx)(b.XL,{className:"text-sm font-medium",children:"Error"}),(0,a.jsx)(b.TN,{className:"text-sm",children:T})]})]}),(0,a.jsx)(r.$,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 -mt-1 -mr-1 hover:bg-red-200",onClick:()=>{J(null),q(null)},children:(0,a.jsx)(d.A,{className:"h-4 w-4"})})]}),U&&(0,a.jsx)("div",{className:"mt-2 flex justify-end",children:(0,a.jsxs)(r.$,{variant:"outline",size:"sm",onClick:ea,disabled:Z,className:"text-xs border-red-300 hover:bg-red-100 hover:text-red-800",children:[Z?(0,a.jsx)(u.A,{className:"h-3 w-3 mr-1 animate-spin"}):(0,a.jsx)(m.A,{className:"h-3 w-3 mr-1"}),"Retry message"]})})]}),0===eu.length&&0===Object.values($).filter(e=>e.isActive).length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[(0,a.jsx)(i.A,{className:"h-12 w-12 text-purple-300 mb-3"}),(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-700 mb-2",children:"How can I help you?"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 max-w-xs",children:"Ask me anything about your data, or how to analyze it. I can help you create cells, explain results, or suggest next steps."})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[eu.map((e,t)=>(0,a.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"," message-enter"),children:(0,a.jsxs)("div",{className:"flex items-start space-x-2 max-w-[85%] ".concat("user"===e.role?"flex-row-reverse space-x-reverse":""),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center ".concat("user"===e.role?"bg-blue-100":"bg-purple-100"),children:"user"===e.role?(0,a.jsx)(g,{className:"h-4 w-4 text-blue-600"}):(0,a.jsx)(i.A,{className:"h-4 w-4 text-purple-600"})}),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"p-3 rounded-lg ".concat("user"===e.role?"bg-blue-100 text-blue-900":"bg-white border border-gray-200 text-gray-800"),children:"model"===e.role?"chat_agent"===e.agent?(()=>{try{let t=JSON.parse(e.content);if(t&&"status_response"===t.type&&t.content)return(0,a.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:t.content})}catch(t){console.error("Failed to parse chat_agent message content:",t,e.content)}return(0,a.jsx)("p",{className:"whitespace-pre-wrap text-sm italic text-gray-500",children:e.content})})():em(e.content):(0,a.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:e.content})}),e.timestamp&&(0,a.jsx)("span",{className:"text-xs text-gray-500 mt-1 px-1",children:ec(e.timestamp)})]})]})},"msg-".concat(t,"-").concat(e.timestamp))),Object.values($).filter(e=>(e.isActive||e.messages.length>0)&&"chat_agent"!==e.agentType).map(e=>{var t;return(0,a.jsx)("div",{className:"flex justify-start message-enter",children:(0,a.jsxs)("div",{className:"flex items-start space-x-2 max-w-[85%]",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center bg-purple-100",children:(0,a.jsx)(i.A,{className:"h-4 w-4 text-purple-600"})}),(0,a.jsx)(A,{open:e.isExpanded,onOpenChange:()=>ed(e.agentType),className:"w-full",children:(0,a.jsxs)("div",{className:"flex flex-col w-full",children:[(0,a.jsx)(S,{asChild:!0,children:(0,a.jsxs)(r.$,{variant:"ghost",size:"sm",className:"flex justify-between items-center p-3 rounded-lg bg-white border border-gray-200 text-gray-800 w-full text-left h-auto",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[e.isActive&&(0,a.jsx)(u.A,{className:"h-4 w-4 animate-spin"}),(0,a.jsxs)("span",{children:[e.agentType," agent"," ",e.isActive?"is working...":"finished."]})]}),e.isExpanded?(0,a.jsx)(h.A,{className:"h-4 w-4"}):(0,a.jsx)(o.A,{className:"h-4 w-4"})]})}),(0,a.jsx)(C,{className:"pt-2 pl-3 pr-3 pb-1 rounded-b-lg border border-t-0 border-gray-200 bg-gray-50",children:(0,a.jsxs)("ul",{className:"space-y-1 text-xs text-gray-600 list-disc list-inside",children:[(()=>{let t=[],s=null;return e.messages.forEach(e=>{let a=e.content;a!==s&&(t.push(e),s=a)}),t.map((e,t)=>(0,a.jsx)("li",{children:e.content},t))})(),!e.isActive&&e.messages.length>0&&(0,a.jsxs)("li",{className:"text-gray-400 italic",children:["End of actions for ",e.agentType]})]})}),e.messages.length>0&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 mt-1 px-1",children:["Last update: ",ec((null===(t=v.find(t=>t.agent===e.agentType))||void 0===t?void 0:t.timestamp)||new Date().toISOString())]})]})})]})},e.agentType)}),M&&(0,a.jsx)("div",{className:"flex justify-center items-center p-4 message-enter",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500",children:[(0,a.jsx)(u.A,{className:"h-5 w-5 animate-spin text-purple-600"}),(0,a.jsx)("span",{children:"Thinking..."})]})}),(0,a.jsx)("div",{ref:K})]})]}),(0,a.jsx)("div",{className:"p-4 border-t bg-white",children:(0,a.jsxs)("form",{onSubmit:ei,className:"flex space-x-2",children:[(0,a.jsx)(l.p,{ref:V,value:N,onChange:e=>_(e.target.value),placeholder:"Ask Sherlog AI a question...",className:"flex-1",disabled:M||!O}),(0,a.jsx)(r.$,{type:"submit",size:"icon",disabled:!N.trim()||M||!O,className:"bg-purple-600 hover:bg-purple-700 text-white",children:M?(0,a.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(f,{className:"h-4 w-4"})})]})})]})})}},49333:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(85507).A)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},49570:(e,t,s)=>{s.d(t,{Ke:()=>w,R6:()=>j,UC:()=>C,bL:()=>A,l9:()=>S,z3:()=>h});var a=s(16606),n=s(78639),r=s(60929),l=s(67768),i=s(12126),o=s(9605),c=s(93925),d=s(75323),u=s(54668),m=s(90702),p="Collapsible",[g,h]=(0,r.A)(p),[f,x]=g(p),y=a.forwardRef((e,t)=>{let{__scopeCollapsible:s,open:n,defaultOpen:r,disabled:i,onOpenChange:o,...d}=e,[p=!1,g]=(0,l.i)({prop:n,defaultProp:r,onChange:o});return(0,m.jsx)(f,{scope:s,disabled:i,contentId:(0,u.B)(),open:p,onOpenToggle:a.useCallback(()=>g(e=>!e),[g]),children:(0,m.jsx)(c.sG.div,{"data-state":_(p),"data-disabled":i?"":void 0,...d,ref:t})})});y.displayName=p;var v="CollapsibleTrigger",j=a.forwardRef((e,t)=>{let{__scopeCollapsible:s,...a}=e,r=x(v,s);return(0,m.jsx)(c.sG.button,{type:"button","aria-controls":r.contentId,"aria-expanded":r.open||!1,"data-state":_(r.open),"data-disabled":r.disabled?"":void 0,disabled:r.disabled,...a,ref:t,onClick:(0,n.m)(e.onClick,r.onOpenToggle)})});j.displayName=v;var N="CollapsibleContent",w=a.forwardRef((e,t)=>{let{forceMount:s,...a}=e,n=x(N,e.__scopeCollapsible);return(0,m.jsx)(d.C,{present:s||n.open,children:e=>{let{present:s}=e;return(0,m.jsx)(b,{...a,ref:t,present:s})}})});w.displayName=N;var b=a.forwardRef((e,t)=>{let{__scopeCollapsible:s,present:n,children:r,...l}=e,d=x(N,s),[u,p]=a.useState(n),g=a.useRef(null),h=(0,o.s)(t,g),f=a.useRef(0),y=f.current,v=a.useRef(0),j=v.current,w=d.open||u,b=a.useRef(w),A=a.useRef(void 0);return a.useEffect(()=>{let e=requestAnimationFrame(()=>b.current=!1);return()=>cancelAnimationFrame(e)},[]),(0,i.N)(()=>{let e=g.current;if(e){A.current=A.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";let t=e.getBoundingClientRect();f.current=t.height,v.current=t.width,b.current||(e.style.transitionDuration=A.current.transitionDuration,e.style.animationName=A.current.animationName),p(n)}},[d.open,n]),(0,m.jsx)(c.sG.div,{"data-state":_(d.open),"data-disabled":d.disabled?"":void 0,id:d.contentId,hidden:!w,...l,ref:h,style:{"--radix-collapsible-content-height":y?"".concat(y,"px"):void 0,"--radix-collapsible-content-width":j?"".concat(j,"px"):void 0,...e.style},children:w&&r})});function _(e){return e?"open":"closed"}var A=y,S=j,C=w},50738:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(85507).A)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]])},71224:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(85507).A)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},75491:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(85507).A)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},96922:(e,t,s)=>{s.d(t,{A:()=>a});let a=(0,s(85507).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}}]);