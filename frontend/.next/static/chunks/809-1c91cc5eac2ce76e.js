"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{29809:(e,t,o)=>{o.d(t,{F:()=>y});var a=o(61994),n=o(41502);let r=async(e,t)=>{if(!e.ok){let t=await e.text(),o="API error: ".concat(e.status);try{let e=JSON.parse(t);e.error&&("string"==typeof e.error?o=e.error:e.error.message&&(o=e.error.message,e.error.type&&(o+=" (".concat(e.error.type,")"))))}catch(e){o+=" - ".concat(t)}throw Error(o)}if(!e.body)throw Error("Response body is null");let o=e.body.getReader(),a=new TextDecoder,n="",r=[];try{for(;;){let{done:e,value:c}=await o.read();if(e)break;let s=(n+=a.decode(c,{stream:!0})).split("\n");for(let e of(n=s.pop()||"",s))if(e.trim())try{if(e.includes('"error":')){let t=JSON.parse(e);if(t.error){let e="Error in response";throw"string"==typeof t.error?e=t.error:t.error.message&&(e=t.error.message,t.error.type&&(e+=" (".concat(t.error.type,")"))),Error(e)}}let o=JSON.parse(e);t(o),r.push(o)}catch(t){if(console.error("Error parsing JSON:",t,"Line:",e),t instanceof Error&&(t.message.includes("Error in response")||t.message.includes("overloaded")))throw t;if(e.includes("error")||e.includes("exception")||e.includes("fail")){let t="Error in response";try{let o=e.match(/"error":\s*"([^"]+)"/);o&&o[1]?t=o[1]:(e.includes("timeout")||e.includes("timed out"))&&(t="Request timed out. The server might be busy.")}catch(o){t="Error in response: ".concat(e.substring(0,100)).concat(e.length>100?"...":"")}throw Error(t)}}}if(n.trim())try{let e=JSON.parse(n);t(e),r.push(e)}catch(e){throw console.error("Error parsing final buffer JSON:",e,"Buffer:",n),Error("Error parsing final chunk: ".concat(e instanceof Error?e.message:String(e)," - Buffer: ").concat(n.substring(0,100),"..."))}return r}catch(e){throw console.error("Error reading stream:",e),e}},c="".concat(n.f,"/api"),s="".concat(n.f,"/api"),i="".concat(n.f,"/api"),l=e=>{let t=e.data;return void 0===t.is_default&&(t.is_default=!1),t},d=(e,t,o)=>{if(console.error("Failed to create ".concat(t||"unknown type"," connection '").concat(o||"unnamed","':"),e),a.A.isAxiosError(e)&&e.response)throw Error(e.response.data.detail||"Failed to create connection: ".concat(e.message));if(e instanceof Error)throw e;throw Error("An unexpected error occurred while creating the connection.")},p={listConnections:async()=>(await a.A.get("".concat(i,"/connections"))).data,getConnectionTypes:async()=>(await a.A.get("".concat(i,"/connections/types"))).data,getConnection:async e=>(await a.A.get("".concat(i,"/connections/").concat(e))).data,async createConnection(e){let{name:t,type:o,...n}=e;if(!t||!o)throw Error("Connection name and type are required.");let r={name:t,payload:{type:o,...n}};try{let e=await a.A.post("".concat(i,"/connections"),r);return l(e)}catch(e){throw d(e,o,t),Error("Connection creation failed.")}},async updateConnection(e,t){let{name:o,type:n,...r}=t,c={};o&&(c.name=o);let s=Object.keys(r).filter(e=>"type"!==e&&"name"!==e).reduce((e,t)=>(e[t]=r[t],e),{});if(Object.keys(s).length>0&&(c.payload={type:n,...s}),!c.name&&!c.payload)throw Error("Update requires at least a name or config field changes.");try{let t=await a.A.put("".concat(i,"/connections/").concat(e),c);return l(t)}catch(e){throw d(e,n,o||"existing connection"),Error("Connection update failed.")}},deleteConnection:async e=>(await a.A.delete("".concat(i,"/connections/").concat(e)),!0),setDefaultConnection:async e=>(await a.A.post("".concat(i,"/connections/").concat(e,"/default")),!0),async getToolsForConnection(e){try{return(await a.A.get("".concat(i,"/connections/").concat(e,"/tools"))).data}catch(o){var t;if(console.error("Failed to fetch tools for connection type ".concat(e,":"),o),a.A.isAxiosError(o)&&(null===(t=o.response)||void 0===t?void 0:t.status)===404)return[];throw o}},async testConnection(e){let{type:t,...o}=e;if(!t)throw Error("Connection type is required for testing.");let n={payload:{type:t,...o}};try{return(await a.A.post("".concat(i,"/connections/test"),n)).data}catch(e){if(console.error("Failed to test ".concat(t," connection:"),e),a.A.isAxiosError(e)&&e.response)return{valid:!1,message:e.response.data.detail||"Testing failed: ".concat(e.message)};if(e instanceof Error)return{valid:!1,message:e.message};return{valid:!1,message:"An unexpected error occurred during testing."}}}},h={list:p.listConnections,getTypes:p.getConnectionTypes,get:p.getConnection,create:p.createConnection,update:p.updateConnection,delete:p.deleteConnection,setDefault:p.setDefaultConnection,test:p.testConnection,getTools:p.getToolsForConnection},u=a.A.create({baseURL:"".concat(n.f,"/api"),headers:{"Content-Type":"application/json"}});u.interceptors.response.use(e=>e,e=>(console.error("API Error:",e),Promise.reject(e)));let y={notebooks:{list:async()=>(await a.A.get("".concat(c,"/notebooks"))).data,get:async e=>(await a.A.get("".concat(c,"/notebooks/").concat(e))).data,create:async e=>(await a.A.post("".concat(c,"/notebooks"),e)).data,update:async(e,t)=>(await a.A.put("".concat(c,"/notebooks/").concat(e),t)).data,delete:async e=>{await a.A.delete("".concat(c,"/notebooks/").concat(e))},sendMessage:async(e,t,o)=>(await a.A.post("".concat(c,"/notebooks/").concat(e,"/cells/").concat(t,"/message"),{message:o})).data},models:{listModels:async()=>(await a.A.get("".concat(s,"/models"))).data,getCurrentModel:async()=>(await a.A.get("".concat(s,"/models/current"))).data,setCurrentModel:async e=>(await a.A.post("".concat(s,"/models/current"),{model_id:e})).data},connections:h,cells:{list:async e=>(await u.get("/notebooks/".concat(e,"/cells"))).data,get:async(e,t)=>(await u.get("/notebooks/".concat(e,"/cells/").concat(t))).data,create:async(e,t)=>{let o={...t,cell_type:t.type};delete o.type,console.log("Creating cell with data:",o);let a=(await u.post("/notebooks/".concat(e,"/cells"),o)).data;return a.cell_type&&!a.type&&(a.type=a.cell_type),a},update:async(e,t,o)=>(await u.put("/notebooks/".concat(e,"/cells/").concat(t),o)).data,delete:async(e,t)=>{await u.delete("/notebooks/".concat(e,"/cells/").concat(t))},execute:async(e,t,o)=>(await u.post("/notebooks/".concat(e,"/cells/").concat(t,"/execute"),o)).data,sendMessage:async(e,t,o)=>(await u.post("/notebooks/".concat(e,"/cells/").concat(t,"/message"),{message:o})).data},chat:{createSession:async e=>{if(!e)throw Error("Notebook ID is required to create a chat session");try{let t=await fetch("".concat(n.f,"/api/chat/sessions"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notebook_id:e})});if(!t.ok){let e=await t.text();throw Error("Failed to create chat session: ".concat(t.status," - ").concat(e))}return await t.json()}catch(e){throw console.error("Error creating chat session:",e),e}},getSessionMessages:async e=>{try{let t=await fetch("".concat(n.f,"/api/chat/sessions/").concat(e,"/messages"));if(!t.ok){let e=await t.text();throw Error("Failed to get session messages: ".concat(t.status," - ").concat(e))}let o=await t.text(),a=[],r=null;for(let e of o.split("\n"))if(e.trim())try{let t=JSON.parse(e);r&&r.role===t.role?(r.content+=t.content,r.timestamp=t.timestamp):(r&&a.push(r),r={...t})}catch(e){console.error("Error parsing message JSON:",e)}return r&&a.push(r),a}catch(e){throw console.error("Error getting session messages:",e),e}},sendMessage:async(e,t,o)=>{try{let a=new FormData;a.append("prompt",t);let c=await fetch("".concat(n.f,"/api/chat/sessions/").concat(e,"/messages"),{method:"POST",body:a});return await r(c,o)}catch(e){throw console.error("Error sending message:",e),e}},deleteSession:async e=>{try{let t=await fetch("".concat(n.f,"/api/chat/sessions/").concat(e),{method:"DELETE"});if(!t.ok){let e=await t.text();throw Error("Failed to delete chat session: ".concat(t.status," - ").concat(e))}}catch(e){throw console.error("Error deleting chat session:",e),e}},unifiedChat:async function(e,t,o){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{};if(!t)throw Error("Notebook ID is required for chat requests");try{let c=await fetch("".concat(n.f,"/api/chat"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,notebook_id:t,session_id:o})});return await r(c,a)}catch(e){throw console.error("Error in unified chat:",e),e}}}}},41502:(e,t,o)=>{o.d(t,{Z:()=>r,f:()=>n});var a=o(66408);let n=a.env.NEXT_PUBLIC_BACKEND_URL||"http://localhost:9091",r=a.env.NEXT_PUBLIC_WS_URL||"ws://localhost:9091/api/notebooks"}}]);