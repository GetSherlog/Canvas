(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[191],{5504:(e,t,o)=>{"use strict";o.d(t,{Fc:()=>i,TN:()=>d,XL:()=>c});var l=o(90702),a=o(16606),n=o(13490),s=o(79321);let r=(0,n.F)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-red-500/50 text-red-800 dark:border-red-500 [&>svg]:text-red-500 bg-red-50"}},defaultVariants:{variant:"default"}}),i=a.forwardRef((e,t)=>{let{className:o,variant:a,...n}=e;return(0,l.jsx)("div",{ref:t,role:"alert",className:(0,s.cn)(r({variant:a}),o),...n})});i.displayName="Alert";let c=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,l.jsx)("h5",{ref:t,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",o),...a})});c.displayName="AlertTitle";let d=a.forwardRef((e,t)=>{let{className:o,...a}=e;return(0,l.jsx)("div",{ref:t,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",o),...a})});d.displayName="AlertDescription"},40283:(e,t,o)=>{"use strict";o.d(t,{h:()=>n});var l=o(16606),a=o(41502);function n(e,t){let[o,n]=(0,l.useState)("disconnected"),s=(0,l.useRef)(null),r=(0,l.useRef)(null),i=(0,l.useCallback)(()=>{var o;if((null===(o=s.current)||void 0===o?void 0:o.readyState)===WebSocket.OPEN)return;s.current&&s.current.close(),n("connecting");let l="".concat(a.Z,"/ws/notebook/").concat(e);console.log("Attempting WebSocket connection to: ".concat(l));try{s.current=new WebSocket(l)}catch(e){console.error("Failed to create WebSocket object for URL: ".concat(l),e),n("error");return}let c=s.current;c.onopen=e=>{console.log("WebSocket onopen event: Connection established",e),n("connected"),r.current&&(clearTimeout(r.current),r.current=null)},c.onmessage=e=>{try{let o=JSON.parse(e.data);console.log("WebSocket onmessage event: Message received:",o),t(o)}catch(t){console.error("WebSocket onmessage event: Failed to parse message:",t,"Raw data:",e.data)}},c.onerror=e=>{console.error("WebSocket onerror event: Error occurred",e),n("error")},c.onclose=e=>{console.log("WebSocket onclose event: Connection closed. Code: ".concat(e.code,", Reason: '").concat(e.reason,"', WasClean: ").concat(e.wasClean),e),n("disconnected"),s.current=null,r.current&&clearTimeout(r.current),console.log("Attempting WebSocket reconnect in 3 seconds..."),r.current=setTimeout(()=>{i()},3e3)}},[e,t]),c=(0,l.useCallback)(()=>{s.current&&(s.current.close(),s.current=null),r.current&&(clearTimeout(r.current),r.current=null),n("disconnected")},[]),d=(0,l.useCallback)((e,t)=>{var o;if((null===(o=s.current)||void 0===o?void 0:o.readyState)===WebSocket.OPEN){let o={type:e,...t,timestamp:Date.now()};return s.current.send(JSON.stringify(o)),!0}return!1},[]);return(0,l.useEffect)(()=>(console.log("[useWebSocket useEffect] Running effect. notebookId: ".concat(e)),e?(console.log("[useWebSocket useEffect] notebookId is valid, calling connect..."),i()):console.log("[useWebSocket useEffect] notebookId is invalid, NOT calling connect."),()=>{console.log("[useWebSocket useEffect] Cleanup running. notebookId: ".concat(e)),c()}),[i,c,e]),{status:o,sendMessage:d,connect:i,disconnect:c}}console.log("Connecting websocket to WS_URL",a.Z)},43466:(e,t,o)=>{"use strict";o.d(t,{$:()=>c});var l=o(90702),a=o(16606),n=o(6101),s=o(13490),r=o(79321);let i=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 transition-all duration-200 hover:shadow-md hover:scale-[1.02]",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 transition-all duration-200 hover:shadow-md hover:scale-[1.02]",outline:"border border-input bg-background hover:bg-primary/10 hover:text-primary hover:border-primary/50 transition-all duration-200 hover:scale-[1.02]",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 transition-all duration-200 hover:shadow-sm hover:scale-[1.02]",ghost:"hover:bg-primary/10 hover:text-primary transition-all duration-200 hover:scale-[1.02]",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80 transition-colors duration-200"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:o,variant:a,size:s,asChild:c=!1,...d}=e,u=c?n.DX:"button";return(0,l.jsx)(u,{className:(0,r.cn)(i({variant:a,size:s,className:o})),ref:t,...d})});c.displayName="Button"},57530:(e,t,o)=>{"use strict";o.d(t,{p:()=>s});var l=o(90702),a=o(16606),n=o(79321);let s=a.forwardRef((e,t)=>{let{className:o,type:a,...s}=e;return(0,l.jsx)("input",{type:a,className:(0,n.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",o),ref:t,...s})});s.displayName="Input"},63518:(e,t,o)=>{"use strict";o.r(t),o.d(t,{default:()=>O});var l=o(90702),a=o(16606),n=o(96188),s=o(43466),r=o(5504),i=o(57530),c=o(6626),d=o(96021),u=o(86304),p=o(12626),g=o(58115),m=o(74508),h=o(31803),v=o(79321);let f=h.bL,b=h.l9,y=a.forwardRef((e,t)=>{let{className:o,align:a="center",sideOffset:n=4,...s}=e;return(0,l.jsx)(h.ZL,{children:(0,l.jsx)(h.UC,{ref:t,align:a,sideOffset:n,className:(0,v.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",o),...s})})});function x(e){let{onAddCell:t}=e,[o,n]=(0,a.useState)(!1),r=e=>{t(e),n(!1)};return(0,l.jsx)("div",{className:"flex justify-center my-2 transition-all duration-300 hover:scale-105",children:(0,l.jsxs)(f,{open:o,onOpenChange:n,children:[(0,l.jsx)(b,{asChild:!0,children:(0,l.jsx)(s.$,{variant:"outline",size:"sm",className:"rounded-full w-8 h-8 p-0 bg-white border border-gray-200 hover:bg-blue-50 hover:border-blue-300 transition-all duration-300 shadow-sm hover:shadow",children:(0,l.jsx)(u.A,{className:"h-4 w-4"})})}),(0,l.jsx)(y,{className:"w-56 p-2 bg-white border shadow-lg animate-suggestion-fade-in",children:(0,l.jsxs)("div",{className:"grid gap-1",children:[(0,l.jsxs)(s.$,{variant:"ghost",className:"flex justify-start items-center px-2 py-1 text-sm hover:bg-blue-50 transition-colors duration-200",onClick:()=>r("markdown"),children:[(0,l.jsx)(p.A,{className:"h-4 w-4 mr-2 text-blue-500"}),(0,l.jsx)("span",{children:"Markdown"})]}),(0,l.jsxs)(s.$,{variant:"ghost",className:"flex justify-start items-center px-2 py-1 text-sm hover:bg-blue-50 transition-colors duration-200",onClick:()=>r("github"),children:[(0,l.jsx)(g.A,{className:"h-4 w-4 mr-2 text-gray-500"}),(0,l.jsx)("span",{children:"Github Tool"})]}),(0,l.jsxs)(s.$,{variant:"ghost",className:"flex justify-start items-center px-2 py-1 text-sm hover:bg-blue-50 transition-colors duration-200",onClick:()=>r("filesystem"),children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-2 text-green-500"}),(0,l.jsx)("span",{children:"Filesystem"})]})]})})]})})}y.displayName=h.UC.displayName;var _=o(52961);function k(e){let{isOpen:t,onToggle:o,notebookId:a}=e;return t?null:(0,l.jsxs)(s.$,{onClick:o,className:"fixed right-6 bottom-6 rounded-full shadow-lg z-30 transition-all duration-300 bg-purple-600 text-white hover:bg-purple-700 hover:shadow-xl px-4 py-3 h-auto",children:[(0,l.jsx)(_.A,{className:"h-5 w-5 mr-2"}),(0,l.jsx)("span",{className:"font-medium",children:"Ask Sherlog"})]})}var w=o(29809),C=o(73554),S=o(93843),N=o(88443);let j=(0,d.default)(()=>Promise.all([o.e(211),o.e(19),o.e(591)]).then(o.bind(o,7591)),{loadableGenerated:{webpack:()=>[7591]},loading:()=>(0,l.jsx)("p",{children:"Loading Markdown Cell..."})}),E=(0,d.default)(()=>Promise.all([o.e(211),o.e(29),o.e(744),o.e(587),o.e(933),o.e(472),o.e(216)]).then(o.bind(o,66163)),{loadableGenerated:{webpack:()=>[66163]},loading:()=>(0,l.jsx)("p",{children:"Loading GitHub Cell..."})}),F=(0,d.default)(()=>Promise.all([o.e(211),o.e(19),o.e(104)]).then(o.bind(o,76104)),{loadableGenerated:{webpack:()=>[76104]},loading:()=>(0,l.jsx)("p",{children:"Loading Summarization Cell..."})}),I=(0,d.default)(()=>Promise.all([o.e(211),o.e(29),o.e(744),o.e(933),o.e(280),o.e(41)]).then(o.bind(o,82041)),{loadableGenerated:{webpack:()=>[82041]},loading:()=>(0,l.jsx)("p",{children:"Loading Report Cell..."})}),D=(0,d.default)(()=>Promise.all([o.e(29),o.e(587),o.e(396),o.e(472),o.e(894)]).then(o.bind(o,17894)),{loadableGenerated:{webpack:()=>[17894]},loading:()=>(0,l.jsx)("p",{children:"Loading FileSystem Cell..."})}),T=(0,d.default)(()=>Promise.all([o.e(29),o.e(744),o.e(154),o.e(79),o.e(704)]).then(o.bind(o,19704)),{loadableGenerated:{webpack:()=>[19704]},loading:()=>(0,l.jsx)("p",{children:"Loading Python Cell..."})}),A=e=>{let{cell:t,onExecute:o,onUpdate:a,onDelete:n,isExecuting:s}=e;switch(t.type){case"markdown":return(0,l.jsx)(j,{cell:t,onUpdate:a,onDelete:n});case"github":return(0,l.jsx)(E,{cell:t,onExecute:o,onUpdate:a,onDelete:n,isExecuting:s});case"summarization":return(0,l.jsx)(F,{cell:t,onDelete:n});case"investigation_report":return(0,l.jsx)(I,{cell:t,onDelete:n});case"filesystem":return(0,l.jsx)(D,{cell:t,onUpdate:a,onExecute:o,onDelete:n,isExecuting:s});case"python":return(0,l.jsx)(T,{cell:t,onExecute:o,onUpdate:a,onDelete:n,isExecuting:s});default:return t.type,(0,l.jsxs)("div",{className:"p-4 border rounded-md bg-red-50",children:[(0,l.jsxs)("p",{children:["Unknown or unsupported cell type: ",t.type]}),(0,l.jsx)("pre",{className:"mt-2 p-2 bg-gray-100 rounded text-sm",children:JSON.stringify(t,null,2)})]})}},P=(0,d.default)(()=>Promise.all([o.e(373),o.e(986)]).then(o.bind(o,14986)),{loadableGenerated:{webpack:()=>[14986]},ssr:!1,loading:()=>(0,l.jsx)("div",{className:"fixed bottom-4 right-4 p-4 bg-gray-700 text-white rounded-lg shadow-lg",children:"Loading Chat..."})});function O(){var e;let t=(0,n.useParams)().id,{toast:o}=(0,C.dj)(),[d,u]=(0,a.useState)(null),[p,g]=(0,a.useState)([]),[m,h]=(0,a.useState)(!0),[v,f]=(0,a.useState)(null),[b,y]=(0,a.useState)(!1),[_,j]=(0,a.useState)(!1),[E,F]=(0,a.useState)(""),[I,D]=(0,a.useState)(""),[T,O]=(0,a.useState)(null),[R,U]=(0,a.useState)(!1);(0,N.F)(e=>e.cells);let W=(0,N.F)(e=>e.setActiveNotebook),M=(0,a.useRef)(!1);(0,a.useEffect)(()=>{t&&(console.log("\uD83D\uDD11 Setting active notebook ID in store:",t),W(t))},[t,W]);let z=(0,a.useCallback)(e=>{console.log("\uD83D\uDD0D handleCreateCell called. Step ID: ".concat(e.step_id,", Cell ID: ").concat(e.id,". Full params:"),e);let o=p.findIndex(t=>{var o;return(null===(o=t.metadata)||void 0===o?void 0:o.step_id)===e.step_id});if(o>=0){console.log("\uD83D\uDD04 Updating existing cell linked to step ID: ".concat(e.step_id," with definitive Cell ID: ").concat(e.id));let t=[...p],l=t[o],{id:a,step_id:n,metadata:s,...r}=e;t[o]={...l,...r,id:e.id,type:e.type,metadata:{...l.metadata,...s||{},step_id:e.step_id},updated_at:new Date().toISOString(),isNew:!1},g(t)}else{console.log("✨ Creating new cell for step ID: ".concat(e.step_id," with definitive Cell ID: ").concat(e.id));let o=new Date().toISOString(),{id:l,step_id:a,metadata:n,...s}=e,r={id:e.id,...s,type:e.type,notebook_id:t,created_at:o,updated_at:o,metadata:{...n||{},step_id:e.step_id},isNew:!0};g(e=>[...e,r]),setTimeout(()=>{g(t=>t.map(t=>t.id===e.id?{...t,isNew:!1}:t))},500)}},[p,t]),G=(0,a.useCallback)((e,t)=>{console.log("\uD83D\uDD04 handleUpdateCell called for Cell ID: ".concat(e," with updates:"),t),g(o=>o.map(o=>o.id===e?{...o,content:void 0!==t.content?t.content:o.content,status:void 0!==t.status?t.status:o.status,result:void 0!==t.result?t.result:o.result,error:void 0!==t.error?t.error:o.error,type:void 0!==t.type?t.type:o.type,id:o.id,notebook_id:o.notebook_id,created_at:o.created_at,updated_at:new Date().toISOString(),metadata:{...o.metadata,...t.metadata}}:o))},[]),L=(0,a.useCallback)(e=>{f(e),o({variant:"destructive",title:"Investigation Error",description:e})},[o]),{wsStatus:$,isInvestigationRunning:H,currentStatus:q}=(0,S.R)({notebookId:t,onCreateCell:z,onUpdateCell:G,onError:L});(0,a.useEffect)(()=>{(async()=>{if(t){h(!0),f(null);try{var e,l;let o=await w.F.notebooks.get(t);if(u(o),F(o.name||(null===(e=o.metadata)||void 0===e?void 0:e.title)||"Untitled Notebook"),D(o.description||(null===(l=o.metadata)||void 0===l?void 0:l.description)||""),w.F.cells&&"function"==typeof w.F.cells.list)try{let e=await w.F.cells.list(t);if(Array.isArray(e))console.log("[CanvasPage] Cells loaded from API:",JSON.stringify(e.map(e=>({id:e.id,type:e.type,result:!!e.result,tool_name:e.tool_name,status:e.status})),null,2)),g(e);else if(o.cells&&"object"==typeof o.cells){let e=Object.values(o.cells);g(e)}else g([])}catch(e){if(console.error("Failed to fetch cells:",e),o.cells&&"object"==typeof o.cells){let e=Object.values(o.cells);g(e)}else g([])}else if(console.warn("api.cells.list is not available, checking for cells in notebook response"),o.cells&&"object"==typeof o.cells){let e=Object.values(o.cells);g(e)}else g([]);W(t),h(!1),M.current=!0}catch(e){console.error("Failed to fetch notebook data:",e),f(e instanceof Error?e.message:"Failed to load canvas"),h(!1),o({variant:"destructive",title:"Error",description:"Failed to load canvas data. Please try again."})}}})()},[t,o,W]),(0,a.useEffect)(()=>{console.log("\uD83D\uDD04 Setting up canvasStore subscription for notebook:",t),console.log("\uD83D\uDD04 Current cells in component state:",p.map(e=>({id:e.id,type:e.type})));let e=N.F.getState().cells,o=N.F.getState().activeNotebookId;if(console.log("\uD83D\uDD04 Initial store cells:",e.map(e=>({id:e.id,type:e.type,notebook_id:e.notebook_id}))),console.log("\uD83D\uDD04 Active notebook ID in store:",o),e.length>0){let o=e.filter(e=>e.notebook_id===t);if(o.length>0){console.log("\uD83D\uDD04 Found relevant cells in store on init:",o.length);let e=new Set(p.map(e=>e.id)),t=o.filter(t=>!e.has(t.id));t.length>0&&(console.log("\uD83D\uDD04 Adding cells from store on init:",t.map(e=>e.id)),g(e=>[...e,...t]))}}let l=N.F.subscribe((e,o)=>{let l=e.cells,a=o.cells;if(console.log("\uD83D\uDD14 Canvas store cells updated - callback triggered"),console.log("\uD83D\uDD14 Previous cells count:",(null==a?void 0:a.length)||0),console.log("\uD83D\uDD14 New cells count:",l.length),console.log("\uD83D\uDD14 Active notebook ID in store:",N.F.getState().activeNotebookId),l.length&&t){let e=l.filter(e=>e.notebook_id===t);console.log("\uD83D\uDD14 Relevant cells for this notebook:",e.map(e=>({id:e.id,type:e.type}))),console.log("\uD83D\uDD14 Notebook ID we're filtering for:",t),e.length?g(t=>{let o=new Set(t.map(e=>e.id));console.log("\uD83D\uDD14 Existing cell IDs in component:",Array.from(o));let l=e.filter(e=>!o.has(e.id));return(console.log("\uD83D\uDD14 New unique cells to add:",l.map(e=>({id:e.id,type:e.type}))),l.length>0)?(console.log("\uD83D\uDD14 Adding new cells to component state"),[...t,...l]):(console.log("\uD83D\uDD14 No new cells to add"),t)}):console.log("\uD83D\uDD14 No relevant cells found for this notebook")}else console.log("\uD83D\uDD14 No cells in store or no notebook ID")});return()=>{console.log("\uD83E\uDDF9 Cleaning up canvasStore subscription"),l()}},[t]),(0,a.useEffect)(()=>{if(M.current&&t){console.log("\uD83D\uDD04 Syncing component with store cells");let e=N.F.getState().cells.filter(e=>e.notebook_id===t);e.length>0&&(console.log("\uD83D\uDD04 Found cells in store to sync:",e.length),g(t=>{let o=new Set(t.map(e=>e.id)),l=e.filter(e=>!o.has(e.id));return l.length>0?(console.log("\uD83D\uDD04 Adding new cells from store sync:",l.length),[...t,...l]):t}))}},[t]),(0,a.useEffect)(()=>{console.log("\uD83D\uDCCA Cells state changed, current count:",p.length),console.log("\uD83D\uDCCA Current cells:",p.map(e=>({id:e.id,type:e.type})))},[p]);let J=async()=>{if(d&&E.trim())try{let e=await w.F.notebooks.update(t,{name:E});u(e),y(!1),o({title:"Success",description:"Canvas name updated successfully."})}catch(e){console.error("Failed to update canvas name:",e),o({variant:"destructive",title:"Error",description:"Failed to update canvas name. Please try again."})}},V=async(e,l)=>{if(t)try{let a="";switch(e){case"markdown":a="# New markdown cell";break;case"github":a="{}";break;case"filesystem":a="list_dir ."}let n=await w.F.cells.create(t,{type:e,content:a,status:"idle"}),s=[...p];s.splice(l,0,{...n,isNew:!0}),g(s),setTimeout(()=>{g(e=>e.map(e=>e.id===n.id?{...e,isNew:!1}:e))},500),o({title:"Success",description:"New ".concat(e," cell added.")})}catch(e){console.error("Failed to create cell:",e),o({variant:"destructive",title:"Error",description:"Failed to create cell. Please try again."})}},X=async e=>{if(t)try{O(e),setTimeout(async()=>{await w.F.cells.delete(t,e),g(p.filter(t=>t.id!==e)),O(null),o({title:"Success",description:"Cell deleted successfully."})},300)}catch(e){console.error("Failed to delete cell:",e),O(null),o({variant:"destructive",title:"Error",description:"Failed to delete cell. Please try again."})}},Z=async(e,l,a)=>{if(t)try{let o=p.findIndex(t=>t.id===e);if(-1===o)return;let n=[...p];n[o]={...n[o],content:l,metadata:{...n[o].metadata,...a}},g(n),await w.F.cells.update(t,e,{content:l,metadata:{...n[o].metadata,...a}})}catch(e){console.error("Failed to update cell content:",e),o({variant:"destructive",title:"Error",description:"Failed to update cell content. Please try again."})}},B=async e=>{if(t)try{var l;let a=p.findIndex(t=>t.id===e);if(-1===a)return;let n=[...p];n[a]={...n[a],status:"queued",result:void 0},g(n);let s=null===(l=p[a].metadata)||void 0===l?void 0:l.toolArgs;await w.F.cells.execute(t,e,{tool_arguments:s||{}}),o({title:"Cell Queued",description:"Cell has been queued for execution."})}catch(l){console.error("Failed to execute cell:",l);let t=p.findIndex(t=>t.id===e);if(-1!==t){let e=[...p];e[t]={...e[t],status:"error",error:l instanceof Error?l.message:"Execution failed"},g(e)}o({variant:"destructive",title:"Error",description:"Failed to execute cell. Please try again."})}},Q=async()=>{if(t&&p.length)try{for(let e of p)"markdown"!==e.type&&await B(e.id);o({title:"Success",description:"All cells executed successfully."})}catch(e){console.error("Failed to run all cells:",e),o({variant:"destructive",title:"Error",description:"Failed to run all cells. Some cells may have errors."})}},K=()=>{U(!R)};return(0,l.jsxs)("div",{className:"p-6 pb-32 ".concat(R?"pr-96":""," transition-all duration-300"),children:[m?(0,l.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):v?(0,l.jsxs)(r.Fc,{variant:"destructive",children:[(0,l.jsx)(r.XL,{children:"Error"}),(0,l.jsx)(r.TN,{children:v})]}):d?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsxs)("div",{className:"flex justify-between items-center border-b pb-4 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center flex-1 mr-4",children:[b?(0,l.jsx)("div",{className:"flex items-center",children:(0,l.jsx)(i.p,{value:E,onChange:e=>F(e.target.value),className:"text-3xl font-bold",onBlur:J,onKeyDown:e=>"Enter"===e.key&&J(),autoFocus:!0})}):(0,l.jsx)("h1",{className:"text-3xl font-bold cursor-pointer hover:text-primary transition-colors duration-200",onClick:()=>y(!0),children:(null==d?void 0:d.name)||(null==d?void 0:null===(e=d.metadata)||void 0===e?void 0:e.title)||"Untitled Notebook"}),(0,l.jsxs)("div",{className:"ml-4 flex items-center flex-shrink-0",children:[(0,l.jsx)("div",{className:"w-2 h-2 rounded-full mr-2 ".concat("connected"===$?"bg-green-500":"connecting"===$?"bg-yellow-500":"bg-red-500")}),(0,l.jsx)("span",{className:"text-xs text-gray-500 mr-4",children:"connected"===$?"Connected":"connecting"===$?"Connecting...":"Disconnected"}),H&&(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"animate-spin h-3 w-3 border-2 border-purple-500 rounded-full border-t-transparent mr-2"}),(0,l.jsx)("span",{className:"text-xs text-purple-700",children:q||"Investigation in progress..."})]})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsxs)(s.$,{variant:"outline",size:"sm",onClick:Q,className:"bg-blue-50 hover:bg-blue-100 border-blue-200",children:[(0,l.jsx)(c.A,{className:"h-4 w-4 mr-1 text-blue-600"}),"Run All"]})})]})}),(0,l.jsxs)("div",{className:"space-y-6",children:[p.map((e,t)=>(0,l.jsxs)("div",{className:"cell-container ".concat(T===e.id?"deleted":""," ").concat(e.isNew?"cell-enter":""),children:[(0,l.jsx)(A,{cell:e,onExecute:()=>B(e.id),onUpdate:Z,onDelete:()=>X(e.id),isExecuting:N.F.getState().isExecuting(e.id)}),t===p.length-1&&(0,l.jsx)(x,{onAddCell:e=>{V(e,t+1)}})]},e.id)),0===p.length&&(0,l.jsxs)("div",{className:"text-center py-12 bg-gray-50 rounded-lg",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"This canvas is empty"}),(0,l.jsx)("p",{className:"text-gray-500 mb-4",children:"Add your first cell to get started"}),(0,l.jsx)(x,{onAddCell:e=>{V(e,0)}})]})]})]}):null,(0,l.jsx)(P,{isOpen:R,onToggle:K,notebookId:t}),(0,l.jsx)(k,{isOpen:R,onToggle:K,notebookId:t})]})}},73554:(e,t,o)=>{"use strict";o.d(t,{dj:()=>p});var l=o(16606);let a=0,n=new Map,s=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},r=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:o}=t;return o?s(o):e.toasts.forEach(e=>{s(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===o||void 0===o?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},i=[],c={toasts:[]};function d(e){c=r(c,e),i.forEach(e=>{e(c)})}function u(e){let{...t}=e,o=(a=(a+1)%Number.MAX_SAFE_INTEGER).toString(),l=()=>d({type:"DISMISS_TOAST",toastId:o});return d({type:"ADD_TOAST",toast:{...t,id:o,open:!0,onOpenChange:e=>{e||l()}}}),{id:o,dismiss:l,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:o}})}}function p(){let[e,t]=l.useState(c);return l.useEffect(()=>(i.push(t),()=>{let e=i.indexOf(t);e>-1&&i.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},78005:(e,t,o)=>{Promise.resolve().then(o.bind(o,63518))},79321:(e,t,o)=>{"use strict";o.d(t,{cn:()=>n});var l=o(82656),a=o(40997);function n(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,a.QP)((0,l.$)(t))}},88443:(e,t,o)=>{"use strict";o.d(t,{F:()=>s});var l=o(15367),a=o(21951),n=o(29809);let s=(0,l.v)()((0,a.lt)((0,a.Zr)((e,t)=>({notebook:null,cells:[],activeNotebookId:null,loading:!1,error:null,executingCells:new Set,wsStatus:"disconnected",wsMessages:[],sendChatMessageFunction:null,isSendingChatMessage:!1,setActiveNotebook:t=>{e({activeNotebookId:t})},loadNotebook:async t=>{if(t){e({loading:!0,error:null});try{let[o,l]=await Promise.all([n.F.notebooks.get(t),n.F.cells.list(t)]);e({notebook:o,cells:l,activeNotebookId:t,loading:!1})}catch(t){console.error("Failed to load notebook:",t),e({error:"Failed to load notebook. Please try again.",loading:!1})}}},executeCell:async o=>{let{activeNotebookId:l}=t();if(l)try{e(e=>({executingCells:new Set(e.executingCells).add(o)})),await n.F.cells.execute(l,o)}catch(t){console.error("Failed to execute cell:",t),e(e=>{let t=new Set(e.executingCells);return t.delete(o),{executingCells:t}})}},updateCell:async(e,o,l)=>{let{activeNotebookId:a}=t();if(a)try{await n.F.cells.update(a,e,{content:o,metadata:l})}catch(e){console.error("Failed to update cell:",e)}},deleteCell:async o=>{let{activeNotebookId:l}=t();if(l)try{await n.F.cells.delete(l,o),e(e=>({cells:e.cells.filter(e=>e.id!==o)}))}catch(e){console.error("Failed to delete cell:",e)}},createCell:async(o,l)=>{let{activeNotebookId:a}=t();if(!a)return null;try{let t=l||"";if(!t)switch(o){case"markdown":t="# New Markdown Cell\n\nEnter your markdown content here.";break;case"github":t="GitHub Tool Cell - Configure in UI";break;case"summarization":t="Summarization results will appear here."}let s=await n.F.cells.create(a,{type:o,content:t});return e(e=>({cells:[...e.cells,s]})),s}catch(e){return console.error("Failed to create cell:",e),null}},updateWsStatus:t=>{e({wsStatus:t})},addWsMessage:o=>{switch(e(e=>({wsMessages:[...e.wsMessages,o]})),o.type){case"cell_update":t().handleCellUpdate(o.data);break;case"cell_execution_started":t().handleCellExecutionStarted(o.data.cell_id);break;case"cell_execution_completed":t().handleCellExecutionCompleted(o.data.cell_id);break;case"notebook_update":t().handleNotebookUpdate(o.data)}},handleCellUpdate:o=>{console.log("\uD83D\uDD27 handleCellUpdate called with cell:",o.id,o.type),console.log("\uD83D\uDD27 Cell notebook_id:",o.notebook_id),console.log("\uD83D\uDD27 Current active notebook ID in store:",t().activeNotebookId);let l=t().cells;console.log("\uD83D\uDD27 Current cells in store before update:",l.map(e=>({id:e.id,type:e.type})));let a=[...l],n=a.findIndex(e=>e.id===o.id);if(console.log("\uD83D\uDD27 Found cell at index:",n),n>=0){let e={...a[n],...o};if(((e,t)=>{if(e===t)return!0;if(!e||!t)return!1;let o=Object.keys(e),l=Object.keys(t);if(o.length!==l.length)return!1;for(let l of o)if(e[l]!==t[l])return!1;return!0})(a[n],e)){console.log("\uD83D\uDD27 No changes detected for cell",o.id,"— skipping state update.");return}console.log("\uD83D\uDD27 Updating existing cell in store:",o.id),a[n]=e}else console.log("\uD83D\uDD27 Adding new cell to store:",o.id,o.type),a.push({...o});console.log("\uD83D\uDD27 New cells array length:",a.length),console.log("\uD83D\uDD27 Is cells array reference changed:",a!==l),e({cells:a})},handleCellExecutionStarted:t=>{e(e=>({executingCells:new Set(e.executingCells).add(t)}))},handleCellExecutionCompleted:t=>{e(e=>{let o=new Set(e.executingCells);return o.delete(t),{executingCells:o}})},handleNotebookUpdate:t=>{e({notebook:t})},isExecuting:e=>t().executingCells.has(e),registerSendChatMessageFunction:t=>{e({sendChatMessageFunction:t})},sendSuggestedStepToChat:async o=>{let{sendChatMessageFunction:l,isSendingChatMessage:a}=t();if(l&&!a){e({isSendingChatMessage:!0});try{console.log('[CanvasStore] Sending suggested step to chat: "'.concat(o,'"')),await l(o)}catch(t){console.error("[CanvasStore] Error sending suggested step to chat:",t),e({error:"Failed to send suggested step to chat."})}finally{e({isSendingChatMessage:!1})}}else a?console.warn("[CanvasStore] Chat message sending already in progress. Ignoring suggested step:",o):console.warn("[CanvasStore] No chat message function registered. Cannot send suggested step:",o)}}),{name:"canvas-store",partialize:e=>({activeNotebookId:e.activeNotebookId})})))},93843:(e,t,o)=>{"use strict";o.d(t,{R:()=>s});var l=o(16606),a=o(40283),n=o(73554);function s(e){let{notebookId:t,onCreateCell:o,onUpdateCell:s,onError:r}=e,[i,c]=(0,l.useState)(null),d=(0,l.useCallback)(e=>{c(e)},[]),{status:u,sendMessage:p}=(0,a.h)(t,d),[g,m]=(0,l.useState)(!1),[h,v]=(0,l.useState)(null),[f,b]=(0,l.useState)(null),[y,x]=(0,l.useState)({}),{toast:_}=(0,n.dj)(),k=(0,l.useCallback)(e=>{m(!0),v(e.thinking),b("Creating investigation plan..."),_({title:"Investigation Started",description:"AI is creating an investigation plan..."})},[_]),w=(0,l.useCallback)(()=>{b("Plan created, executing steps...")},[]),C=(0,l.useCallback)(e=>{var t,l,a,n;x(t=>({...t,[e.step_id]:e})),b("Completed step ".concat(e.step_id));let s=(null===(t=e.cell_params)||void 0===t?void 0:t.content)||(null===(l=e.result)||void 0===l?void 0:l.query)||"";"markdown"===e.step_type&&(null===(a=e.result)||void 0===a?void 0:a.data)&&(s=String(e.result.data));let r="markdown";"github"===e.step_type?r="github":("log"===e.step_type||"metric"===e.step_type)&&(r="markdown"),o({id:e.cell_id,step_id:e.step_id,type:r,content:s,status:e.result.error?"error":"success",result:e.result.data,error:e.result.error||void 0,metadata:{...e.result.metadata||{},...(null===(n=e.cell_params)||void 0===n?void 0:n.metadata)||{}}}),_({title:"Step Completed",description:"Investigation step ".concat(e.step_id," completed")})},[o,_]),S=(0,l.useCallback)(e=>{v(t=>t?"".concat(t,"\\n\\n### Plan Revision\\n").concat(e.explanation):e.explanation),b("Investigation plan revised"),_({title:"Plan Revised",description:"The investigation plan has been updated based on findings."})},[h,_]),N=(0,l.useCallback)(e=>{b("Generating final answer..."),_({title:"Summarizing Findings",description:"AI is generating the final answer..."})},[_]),j=(0,l.useCallback)(e=>{let{update_info:t}=e,o="Summarization in progress...";t.message?o=t.message:t.status&&(o="Summarization status: ".concat(t.status)),b(o),t.error&&(console.error("Summarization update error:",t.error),_({variant:"destructive",title:"Summarization Issue",description:"An issue occurred during summary generation: ".concat(t.error)}))},[_]),E=(0,l.useCallback)(e=>{let t=e.cell_params;o({id:e.cell_id,step_id:t.step_id||"final_summary",type:"markdown",content:t.content||"",status:e.error?"error":"success",result:null,error:e.error||void 0,metadata:t.metadata}),m(!1),b("Investigation complete."),e.error?_({title:"Investigation Complete (with Summary Issue)",description:"Investigation finished, but there was an issue generating the summary: ".concat(e.error)}):_({title:"Investigation Complete",description:"The investigation has finished and the final answer is ready."})},[o,_]),F=(0,l.useCallback)(e=>{let t="Failed to create final summary cell: ".concat(e.error);console.error(t),r(t),b("Error creating final summary cell."),m(!1),_({variant:"destructive",title:"Summary Cell Error",description:t})},[r,_]),I=(0,l.useCallback)(e=>{b("Completed tool: ".concat(e.tool_name));let t=e.cell_params||{},l=t.metadata||{},a={id:e.cell_id,step_id:e.original_plan_step_id,type:"github",content:t.content||"GitHub: ".concat(e.tool_name),status:"success",result:e.result,error:void 0,metadata:{...l,tool_name:e.tool_name,tool_args:e.tool_args,tool_call_record_id:e.tool_call_record_id,pydantic_ai_tool_call_id:l.pydantic_ai_tool_call_id,source_agent:e.agent_type}};console.log("[handleGithubToolCellCreated] Creating cell ".concat(e.cell_id," with status: success and result.")),o(a),_({title:"GitHub Tool Completed",description:"Tool '".concat(e.tool_name,"' executed successfully.")})},[o,_]),D=(0,l.useCallback)(e=>{let t="GitHub tool '".concat(e.tool_name||"unknown"," failed: ").concat(e.error);console.error(t),r(t),b("Error executing tool: ".concat(e.tool_name||"unknown")),_({variant:"destructive",title:"GitHub Tool Error",description:t})},[r,_]),T=(0,l.useCallback)(e=>{b("Completed tool: ".concat(e.tool_name));let t=e.cell_params||{},l=t.metadata||{},a={id:e.cell_id,step_id:e.original_plan_step_id,type:"filesystem",content:t.content||"Filesystem: ".concat(e.tool_name),status:"success",result:e.result,error:void 0,metadata:{...l,tool_name:e.tool_name,tool_args:e.tool_args,source_agent:e.agent_type}};console.log("[handleFileSystemToolCellCreated] Creating cell ".concat(e.cell_id," with status: success and result.")),o(a),_({title:"Filesystem Tool Completed",description:"Tool '".concat(e.tool_name,"' executed successfully.")})},[o,_]),A=(0,l.useCallback)(e=>{let t="Filesystem tool '".concat(e.tool_name||"unknown"," failed: ").concat(e.error);console.error(t),r(t),b("Error executing tool: ".concat(e.tool_name||"unknown")),_({variant:"destructive",title:"Filesystem Tool Error",description:t})},[r,_]),P=(0,l.useCallback)(e=>{var t,l;b("Completed Python execution: ".concat(e.tool_name));let a=e.cell_params||{},n=a.metadata||{},s=e.tool_args||{},r={id:e.cell_id,step_id:e.original_plan_step_id,type:"python",content:s.python_code||a.content||"Python code execution",status:"success",result:null===(t=e.result)||void 0===t?void 0:t.content,error:(null===(l=e.result)||void 0===l?void 0:l.error)||void 0,metadata:{...n,tool_name:e.tool_name,tool_args:s,source_agent:e.agent_type}};console.log("[handlePythonToolCellCreated] Creating cell ".concat(e.cell_id," with type: python, status: success.")),o(r),_({title:"Python Execution Completed",description:"Code execution via '".concat(e.tool_name,"' successful.")})},[o,_,b]),O=(0,l.useCallback)(e=>{let t="Python execution via '".concat(e.tool_name||"run_python_code","' failed: ").concat(e.error);console.error(t),r(t),b("Error executing Python code: ".concat(e.tool_name||"run_python_code")),_({variant:"destructive",title:"Python Execution Error",description:t})},[r,_,b]),R=(0,l.useCallback)(e=>{let t=e.type.split("_")[1],o=e.update_info;console.log("Received update for step ".concat(t,":"),o),b("Updating step ".concat(t,": ").concat((null==o?void 0:o.message)||(null==o?void 0:o.status)||"..."))},[s]),U=(0,l.useCallback)(e=>{b("Error: ".concat(e.message)),r(e.message),_({variant:"destructive",title:"Investigation Error",description:e.message})},[r,_]),W=(0,l.useCallback)(e=>{b("Final investigation report generated."),m(!1);let t=e.cell_params||{},l={id:e.cell_id,step_id:t.step_id||"final_report",type:"investigation_report",content:e.report.title||"Investigation Report",status:e.report.error?"error":"success",result:e.report,error:e.report.error||void 0,metadata:{...t.metadata||{},source_agent:e.agent_type}};console.log("[handleInvestigationReport] Creating cell ".concat(e.cell_id,' with type: "investigation_report"')),o(l),_({title:"Investigation Report Ready",description:"The final investigation report has been generated."})},[o,_]),M=(0,l.useCallback)(e=>{let{id:t,...o}=e.data;console.log("[handleCellUpdate] Updating cell ".concat(t," with data:"),o),s(t,o)},[s]),z=(0,l.useCallback)(e=>{if(!e||"object"!=typeof e||!e.type){console.warn("Received invalid or null event in handleEvent, skipping:",e);return}switch(console.log("Received investigation event:",e),e.type){case"plan_created":k(e);break;case"plan_cell_created":w();break;case"plan_revised":S(e);break;case"summary_started":N(e);break;case"summary_update":j(e);break;case"summary_cell_created":E(e);break;case"summary_cell_error":F(e);break;case"github_tool_cell_created":I(e);break;case"github_tool_error":D(e);break;case"error":U(e);break;case"investigation_report":W(e);break;case"cell_update":M(e);break;case"filesystem_tool_cell_created":T(e);break;case"filesystem_tool_error":A(e);break;case"python_tool_cell_created":P(e);break;case"python_tool_error":O(e);break;default:e.type.startsWith("step_")&&e.type.endsWith("_completed")?C(e):"investigation_complete"===e.type?(console.log("Received investigation_complete signal"),m(!1),b("Investigation finished.")):e.type.startsWith("step_")&&e.type.endsWith("_event")?R(e):console.warn("Unknown event type:",e.type)}},[k,w,S,N,j,E,F,I,D,U,C,R,W,M,T,A,P,O]);return(0,l.useEffect)(()=>{if(i)try{console.log("[useInvestigationEvents] Processing latest event:",i),z(i)}catch(t){console.error("Error handling investigation event:",t);let e=t instanceof Error?t.message:String(t);r("Failed to process event: ".concat(e))}},[i,z,r]),{wsStatus:u,isInvestigationRunning:g,currentPlan:h,currentStatus:f,steps:y}}}},e=>{var t=t=>e(e.s=t);e.O(0,[778,994,484,809,393,685,358],()=>t(78005)),_N_E=e.O()}]);